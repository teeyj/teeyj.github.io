@*newwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww*@
@model Demo.Models.CourseAB

@{
    ViewBag.Title = "Update Course";
}

<div class="container mt-4">


    <form asp-action="Update" method="post" enctype="multipart/form-data" class="card shadow-lg p-4">

        <!-- ID -->
        <div class="mb-3">
            <label asp-for="Id" class="form-label fw-bold">Course ID</label>
            <input asp-for="Id" class="form-control" readonly />
        </div>

        <!-- Name -->
        <div class="mb-3">
            <label asp-for="Name" class="form-label fw-bold">Name</label>
            <input asp-for="Name" class="form-control" />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>

        <!-- Price -->
        <div class="mb-3">
            <label asp-for="Price" class="form-label fw-bold">Price (per class)</label>
            <input asp-for="Price" class="form-control"readonly />
            <span asp-validation-for="Price" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Course Status</label>

            <div class="form-check form-switch">
                <input asp-for="IsActive"
                       class="form-check-input"
                       type="checkbox"
                       id="isActiveSwitch" />

                <label class="form-check-label" for="isActiveSwitch">
                    Active / Deactive
                </label>
            </div>

            <small class="text-muted">
                Turn OFF to hide this course from users.
            </small>
        </div>

        <!-- Current main image -->
        <div class="mb-3">
            <label class="form-label fw-bold">Current Main Image</label><br />
            <img src="/products/@Model.PhotoURL" width="150" class="img-thumbnail shadow-sm" />
        </div>

        <!-- Upload new main image -->
        <div class="mb-3">
            <label asp-for="Photo" class="form-label fw-bold">Upload New Main Image</label>
            <input asp-for="Photo" type="file" class="form-control" onchange="previewSingle(event)" />
            <span asp-validation-for="Photo" class="text-danger"></span>
            <div class="mt-2">
                <img id="singlePreview" style="max-width:150px; display:none;" class="img-thumbnail border" />
            </div>
        </div>

        <!-- Current multiple images -->
        <div class="mb-3">
            <label class="form-label fw-bold">Current Multiple Photos</label>

            <div class="d-flex flex-wrap gap-3 mt-2" id="existingPhotos">
                @if (Model.PhotoURLs != null && Model.PhotoURLs.Any())
                {
                    foreach (var url in Model.PhotoURLs)
                    {
                        <div class="position-relative photo-box">
                            <img src="/products/@url"
                                 width="120"
                                 class="img-thumbnail shadow-sm" />

                            <!-- ❌ delete button -->
                            <button type="button"
                                    class="btn btn-danger btn-sm position-absolute top-0 end-0"
                                    onclick="markDelete(this, '@url')">
                                ❌
                            </button>
                        </div>
                    }
                }
                else
                {
                    <p class="text-muted">No additional photos uploaded.</p>
                }
            </div>
        </div>

        <!-- hidden inputs for delete -->
        <div id="deleteInputs"></div>

        <!-- Upload new multiple images -->
        <div class="mb-3">
            <label asp-for="Photos" class="form-label fw-bold">Upload New Multiple Photos</label>
            <input asp-for="Photos" type="file" multiple class="form-control" onchange="previewMultiple(event)" />
            <span asp-validation-for="Photos" class="text-danger"></span>
            <div id="multiPreview" class="d-flex flex-wrap gap-2 mt-2"></div>
        </div>

        <!-- Buttons -->
        <div class="d-flex justify-content-between">
            <a asp-action="Index" class="btn btn-secondary px-4">Back</a>
            <button type="submit" class="btn btn-primary px-4">Update</button>
        </div>
    </form>
</div>


@section Scripts {
    <script>
        // show one image
        function previewSingle(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('singlePreview');
            if (file) {
                preview.src = URL.createObjectURL(file);
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        // multiple image
        function previewMultiple(event) {
            const files = event.target.files;
            const container = document.getElementById('multiPreview');
            container.innerHTML = "";
            Array.from(files).forEach(file => {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.style.maxWidth = "120px";
                img.classList.add("img-thumbnail", "shadow-sm");
                container.appendChild(img);
            });
        }
    </script>


    <script>
        function markDelete(btn, url) {
            // hide image box
            const box = btn.closest('.photo-box');
            box.style.display = 'none';

            // create hidden input
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'DeletePhotoURLs';
            input.value = url;

            document.getElementById('deleteInputs').appendChild(input);
        }
    </script>

}